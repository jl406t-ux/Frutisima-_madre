<script>
const WA="5214774961901";
let cart=[];

function addToCart(name,id,hasSize,hasFruit){
  const r=document.getElementById(id);
  const size=hasSize ? r.querySelector('[data-field="size"]').value : '';
  const qty=parseInt(r.querySelector('[data-field="qty"]').value) || 1;
  const notes=r.querySelector('[data-field="notes"]').value;
  const fruits=hasFruit ? [...r.querySelectorAll('[data-field="fruit"]:checked')].map(e=>e.value) : [];
  const extras=[...r.querySelectorAll('[data-field="extra"]:checked')].map(e=>e.value);

  // ðŸ’° PRECIO BASE
  let price = 0;

  if(name==="Fruta preparada"){
    if(size.includes("Chico")) price = 35;
    if(size.includes("Mediano")) price = 45;
    if(size.includes("Grande")) price = 60;
  }

  if(name==="Caldo de oso"){
    if(size.includes("Chico")) price = 40;
    if(size.includes("Grande")) price = 60;
  }

  if(name==="Dorilocos" || name==="Papas locas"){
    price = 50;
  }

  // ðŸ¥­ EXTRA MANGO +10
  let mangoExtra = false;
  if(fruits.includes("Mango")){
    price += 10;
    mangoExtra = true;
  }

  cart.push({
    name,
    size,
    qty,
    fruits,
    extras,
    notes,
    price,
    mangoExtra
  });

  render();
}

function render(){
  const l=document.getElementById('cartList');
  l.innerHTML='';

  cart.forEach((i,n)=>{
    l.innerHTML+=`
    <div class="item">
      <b>${n+1}) ${i.qty} ${i.name} â€” $${i.price}</b><br>
      ${i.size ? `TamaÃ±o: ${i.size}<br>` : ``}
      ${i.fruits.length ? `Frutas: ${i.fruits.join(', ')}${i.mangoExtra ? ' (+ Mango $10)' : ''}<br>` : ``}
      ${i.extras.length ? `Extras: ${i.extras.join(', ')}<br>` : ``}
      ${i.notes ? `Obs: ${i.notes}` : ``}
    </div>`;
  });
}

function clearCart(){
  cart=[];
  render();
}

function checkout(){
  let m="Hola, quiero pedir en FRUTÃSIMA MADRE:\n";

  cart.forEach((i,n)=>{
    m+=`\n${n+1}) ${i.qty} ${i.name} â€” $${i.price}`;
    if(i.size) m+=`\n   TamaÃ±o: ${i.size}`;
    if(i.fruits.length){
      m+=`\n   Frutas: ${i.fruits.join(', ')}`;
      if(i.mangoExtra) m+=` (+ Mango $10)`;
    }
    if(i.extras.length) m+=`\n   Extras: ${i.extras.join(', ')}`;
    if(i.notes) m+=`\n   Obs: ${i.notes}`;
  });

  location.href=`https://wa.me/${WA}?text=${encodeURIComponent(m)}`;
}
</script>
