<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Frut√≠sima Madre</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@600;800;900&family=Inter:wght@400;600;800&display=swap" rel="stylesheet">

<style>
:root{
  --bg:#f6f7fb;
  --card:#ffffff;
  --text:#0f172a;
  --muted:#64748b;
  --line:#e5e7eb;
  --green:#22c55e;
  --green2:#16a34a;
  --dark:#0f172a;
  --shadow: 0 12px 32px rgba(15,23,42,.12);
  --shadow2: 0 18px 44px rgba(15,23,42,.16);
  --r:18px;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
  color:var(--text);
  background:
    radial-gradient(900px 420px at 10% -10%, rgba(34,197,94,.15), transparent 55%),
    radial-gradient(900px 420px at 90% -10%, rgba(239,68,68,.08), transparent 55%),
    var(--bg);
  padding:16px;
  padding-bottom: calc(16px + 130px);
}
.container{ max-width:1100px; margin:0 auto; }

header{ text-align:center; margin:8px 0 10px; }
header img{
  width:min(280px, 72vw);
  height:auto;
  filter: drop-shadow(0 12px 18px rgba(0,0,0,.15));
  animation: popIn .45s ease both;
}
@keyframes popIn{
  from{opacity:0; transform:scale(.96) translateY(-6px)}
  to{opacity:1; transform:scale(1) translateY(0)}
}

/* promo */
.ad{
  background: var(--card);
  border: 1px solid rgba(229,231,235,.95);
  border-radius: var(--r);
  overflow:hidden;
  box-shadow: var(--shadow);
  margin: 10px auto 18px;
}
.ad-text{
  padding: 12px 14px;
  font-family:Poppins, Inter, sans-serif;
  font-weight: 900;
  font-size: 14px;
  line-height: 1.25;
  border-bottom: 1px solid rgba(229,231,235,.95);
  background: rgba(255,255,255,.9);
}
.ad-media{ height:250px; overflow:hidden; }
.ad-media img{ width:100%; height:100%; object-fit:cover; display:block; }

/* grid */
.grid{ display:grid; grid-template-columns:1fr; gap:16px; }
@media(min-width:720px){ .grid{ grid-template-columns:1fr 1fr; } }
@media(min-width:1040px){ .grid{ grid-template-columns:1fr 1fr 1fr; } }

/* cards */
.card{
  background: var(--card);
  border: 1px solid rgba(229,231,235,.95);
  border-radius: var(--r);
  overflow:hidden;
  box-shadow: var(--shadow);
  transition: transform .18s ease, box-shadow .18s ease;
}
.card:hover{ transform: translateY(-2px); box-shadow: var(--shadow2); }

.media{ height:210px; position:relative; overflow:hidden; }
.media img{ width:100%; height:100%; object-fit:cover; transform:scale(1.02); transition: transform .35s ease; }
.card:hover .media img{ transform:scale(1.05); }
.media::after{
  content:"";
  position:absolute; inset:0;
  background: linear-gradient(to top, rgba(15,23,42,.45), rgba(15,23,42,.06) 60%, transparent);
}
.titlebar{
  position:absolute; left:12px; right:12px; bottom:12px;
  display:flex; justify-content:space-between; align-items:flex-end; gap:10px;
}
.ptitle{
  color:#fff;
  font-family:Poppins, Inter, sans-serif;
  font-weight: 900;
  font-size: 18px;
  text-shadow: 0 14px 30px rgba(0,0,0,.35);
}
.badge{
  background: rgba(255,255,255,.92);
  border: 1px solid rgba(255,255,255,.65);
  border-radius:999px;
  padding: 8px 10px;
  font-weight: 900;
  font-size: 12px;
  box-shadow: 0 14px 30px rgba(0,0,0,.18);
}
.content{ padding: 12px 12px 14px; }
label{
  display:block;
  margin-top: 10px;
  font-weight: 900;
  font-size: 12px;
}
select, input, textarea{
  width:100%;
  margin-top: 6px;
  padding: 11px 12px;
  border-radius: 12px;
  border: 1px solid #d1d5db;
  background:#fff;
  outline:none;
  transition: box-shadow .18s ease, border-color .18s ease;
}
select:focus, input:focus, textarea:focus{
  border-color: rgba(34,197,94,.6);
  box-shadow: 0 0 0 4px rgba(34,197,94,.14);
}
textarea{ min-height: 66px; resize: vertical; }

/* extras */
.extras{
  display:grid;
  grid-template-columns: 1fr;
  gap:8px;
  margin-top: 8px;
}
@media(min-width:520px){
  .extras.two{ grid-template-columns: 1fr 1fr; }
}
.opt{
  display:flex; align-items:center; gap:10px;
  padding: 10px 10px;
  border-radius: 12px;
  border: 1px solid rgba(229,231,235,.95);
  background:#fff;
  transition: background .15s ease, transform .06s ease;
}
.opt:hover{ background:#f8fafc; }
.opt:active{ transform: scale(.99); }
.opt input{ width:auto; margin:0; accent-color: var(--green); }
.opt small{ color: var(--muted); font-weight:800; }

/* buttons */
.btn{
  width:100%;
  margin-top: 12px;
  padding: 14px 14px;
  border:none;
  border-radius: 14px;
  font-weight: 1000;
  cursor:pointer;
  transition: transform .06s ease, filter .18s ease, box-shadow .18s ease;
  font-family:Poppins, Inter, sans-serif;
}
.btn:active{ transform: translateY(1px) scale(.995); }
.btn-add{
  background: linear-gradient(135deg, var(--dark), #111827);
  color:#fff;
  box-shadow: 0 14px 30px rgba(15,23,42,.18);
}
.btn-add:hover{ filter: brightness(1.06); }

/* toast */
.toast{
  position: fixed;
  left: 50%;
  transform: translateX(-50%) translateY(14px);
  bottom: calc(84px + env(safe-area-inset-bottom));
  z-index: 9999;
  background: rgba(15,23,42,.92);
  color:#fff;
  border-radius:999px;
  padding: 12px 14px;
  box-shadow: 0 18px 40px rgba(0,0,0,.25);
  display:flex; align-items:center; gap:10px;
  opacity:0; pointer-events:none;
  transition: .18s ease;
  font-weight: 900;
  font-size: 13px;
}
.toast.show{ opacity:1; pointer-events:auto; transform: translateX(-50%) translateY(0); }
.toast button{
  border:none;
  background: linear-gradient(135deg, var(--green), var(--green2));
  color:#06110a;
  font-weight: 1000;
  border-radius:999px;
  padding: 8px 10px;
  cursor:pointer;
}

/* FAB */
.fab{
  position: fixed;
  left: 50%;
  transform: translateX(-50%);
  bottom: calc(14px + env(safe-area-inset-bottom));
  z-index: 9000;
  width: min(560px, calc(100vw - 24px));
  background: rgba(255,255,255,.96);
  border: 1px solid rgba(229,231,235,.95);
  box-shadow: 0 18px 45px rgba(15,23,42,.22);
  border-radius: 999px;
  padding: 10px 12px;
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap: 10px;
  backdrop-filter: blur(10px);
}
.fab.hide{ display:none; }
.fab .left{ display:flex; align-items:center; gap:10px; }
.fab .dot{
  width: 44px; height: 44px; border-radius:999px;
  display:grid; place-items:center;
  background: linear-gradient(135deg, var(--green), var(--green2));
  color:#06110a;
  font-weight: 1000;
  box-shadow: 0 16px 34px rgba(34,197,94,.25);
}
.fab .meta{ display:flex; flex-direction:column; line-height:1.15; }
.fab .meta strong{ font-family:Poppins, Inter, sans-serif; font-size:14px; }
.fab .meta span{ font-size:12px; color:var(--muted); font-weight:900; }
.fab .money{ font-family:Poppins, Inter, sans-serif; font-weight:1000; font-size:16px; }
.fab .cta{
  border:none;
  border-radius:999px;
  padding: 10px 12px;
  cursor:pointer;
  font-weight: 1000;
  background: linear-gradient(135deg, var(--dark), #111827);
  color:#fff;
}
.fab .cta:active{ transform: translateY(1px); }

/* modal */
.overlay{
  position:fixed; inset:0;
  background: rgba(15,23,42,.55);
  opacity:0; pointer-events:none;
  transition:.18s ease;
  z-index: 9997;
}
.panel{
  position:fixed;
  right: 12px; left: 12px;
  bottom: calc(80px + env(safe-area-inset-bottom));
  max-width: 560px;
  margin: 0 auto;
  background: rgba(255,255,255,.98);
  border: 1px solid rgba(229,231,235,.95);
  border-radius: 18px;
  box-shadow: 0 30px 70px rgba(15,23,42,.30);
  transform: translateY(16px);
  opacity:0; pointer-events:none;
  transition: .18s ease;
  z-index: 9998;
  overflow:hidden;
}
.panel.open, .overlay.open{ opacity:1; pointer-events:auto; }
.panel.open{ transform: translateY(0); }
.panel-head{
  padding: 12px 14px;
  border-bottom: 1px solid rgba(229,231,235,.95);
  display:flex; align-items:center; justify-content:space-between;
}
.panel-head h3{
  margin:0;
  font-family:Poppins, Inter, sans-serif;
  font-size: 16px;
}
.xbtn{
  border: 1px solid rgba(229,231,235,.95);
  background: #fff;
  border-radius: 12px;
  padding: 8px 10px;
  cursor:pointer;
  font-weight: 1000;
}
.panel-body{
  padding: 12px 14px 14px;
  max-height: 55vh;
  overflow:auto;
}
.item{
  border: 1px solid rgba(229,231,235,.95);
  border-radius: 14px;
  padding: 10px 10px;
  background:#fff;
  margin-bottom: 10px;
}
.item b{font-family:Poppins, Inter, sans-serif}
.row{ display:flex; justify-content:space-between; gap:10px; align-items:flex-start; }
.mini{
  border:1px solid rgba(229,231,235,.95);
  background:#f8fafc;
  border-radius: 12px;
  padding: 8px 10px;
  cursor:pointer;
  font-weight: 1000;
}
.small{
  margin-top: 8px;
  color: var(--muted);
  font-size: 12px;
  white-space: pre-wrap;
  font-weight: 700;
}
.totals{
  margin-top: 10px;
  border: 1px dashed rgba(209,213,219,.95);
  border-radius: 14px;
  background:#f8fafc;
  padding: 10px 12px;
}
.totals .trow{ display:flex; justify-content:space-between; margin: 8px 0; font-weight: 900; }
.wa{
  width:100%;
  margin-top: 10px;
  padding: 14px 14px;
  border:none;
  border-radius: 14px;
  cursor:pointer;
  font-weight: 1000;
  background: linear-gradient(135deg, #25d366, #12b453);
  color:#06110a;
  box-shadow: 0 16px 34px rgba(37,211,102,.22);
}
.danger{
  width:100%;
  margin-top: 10px;
  padding: 14px 14px;
  border:none;
  border-radius: 14px;
  cursor:pointer;
  font-weight: 1000;
  background: linear-gradient(135deg, #ef4444, #dc2626);
  color:#fff;
  box-shadow: 0 16px 34px rgba(239,68,68,.18);
}
</style>
</head>

<body>
<div class="container">
  <header>
    <img src="logo.jpg" alt="Frut√≠sima Madre">
  </header>

  <section class="ad" aria-label="Promoci√≥n">
    <div class="ad-text">
      Este Mi√©rcoles de Ceniza y todos los viernes prueba nuestras botanas con aguachile de camar√≥n
    </div>
    <div class="ad-media">
      <img src="tostittos.jpg" alt="Promoci√≥n Tostitos">
    </div>
  </section>

  <div class="grid">

    <!-- 1) FRUTA PREPARADA -->
    <div class="card" id="prod-fruta">
      <div class="media">
        <img src="fruta.jpg" alt="Fruta preparada">
        <div class="titlebar">
          <div class="ptitle">üçâ Fruta preparada</div>
          <div class="badge">Tama√±o + extras</div>
        </div>
      </div>
      <div class="content">
        <label>Tama√±o</label>
        <select data-field="size">
          <option value="35">Chico</option>
          <option value="45">Mediano</option>
          <option value="60">Grande</option>
        </select>

        <label>Mango (+$10)</label>
        <select data-field="mango">
          <option value="0">Sin mango</option>
          <option value="10">Con mango (+$10)</option>
        </select>

        <label>Extras</label>
        <div class="extras two" data-field="extras">
          <label class="opt"><input type="checkbox" value="0" data-label="Chile pica"> <span>Chile pica</span></label>
          <label class="opt"><input type="checkbox" value="0" data-label="Chile no pica"> <span>Chile no pica</span></label>
          <label class="opt"><input type="checkbox" value="0" data-label="Queso rallado"> <span>Queso rallado</span></label>
          <label class="opt"><input type="checkbox" value="0" data-label="Lim√≥n"> <span>Lim√≥n</span></label>
          <label class="opt"><input type="checkbox" value="0" data-label="Chamoy de jamaica"> <span>Chamoy de jamaica</span></label>
          <label class="opt"><input type="checkbox" value="0" data-label="Chile Miguelito"> <span>Chile Miguelito</span></label>
        </div>

        <label>Cantidad</label>
        <input type="number" data-field="qty" value="1" min="1">

        <label>Observaciones</label>
        <textarea data-field="notes" placeholder="Ej: sin queso, m√°s chamoy..."></textarea>

        <button class="btn btn-add" type="button" onclick="addToCartFrom('Fruta preparada','prod-fruta')">‚ûï Agregar</button>
      </div>
    </div>

    <!-- 2) CALDO DE OSO -->
    <div class="card" id="prod-caldo">
      <div class="media">
        <img src="caldo.jpg" alt="Caldo de oso">
        <div class="titlebar">
          <div class="ptitle">üç∫ Caldo de oso</div>
          <div class="badge">Tama√±o + extras</div>
        </div>
      </div>
      <div class="content">
        <label>Tama√±o</label>
        <select data-field="size">
          <option value="40">Chico</option>
          <option value="60">Grande</option>
        </select>

        <label>Mango (+$10)</label>
        <select data-field="mango">
          <option value="0">Sin mango</option>
          <option value="10">Con mango (+$10)</option>
        </select>

        <label>Extras</label>
        <div class="extras two" data-field="extras">
          <label class="opt"><input type="checkbox" value="0" data-label="Chile pica"> <span>Chile pica</span></label>
          <label class="opt"><input type="checkbox" value="0" data-label="Chile no pica"> <span>Chile no pica</span></label>
          <label class="opt"><input type="checkbox" value="0" data-label="Queso rallado"> <span>Queso rallado</span></label>
          <label class="opt"><input type="checkbox" value="0" data-label="Lim√≥n"> <span>Lim√≥n</span></label>
          <label class="opt"><input type="checkbox" value="10" data-label="Camar√≥n seco (+$10)"> <span>Camar√≥n seco <small>(+$10)</small></span></label>
        </div>

        <label>Cantidad</label>
        <input type="number" data-field="qty" value="1" min="1">

        <label>Observaciones</label>
        <textarea data-field="notes" placeholder="Ej: con mucho vinagre..."></textarea>

        <button class="btn btn-add" type="button" onclick="addToCartFrom('Caldo de oso','prod-caldo')">‚ûï Agregar</button>
      </div>
    </div>

    <!-- 3) DORILOCOS -->
    <div class="card" id="prod-dori">
      <div class="media">
        <img src="dorilocos.jpg" alt="Dorilocos">
        <div class="titlebar">
          <div class="ptitle">üå∂Ô∏è Dorilocos</div>
          <div class="badge">$50</div>
        </div>
      </div>
      <div class="content">
        <div class="extras two" data-field="extras">
          <label class="opt"><input type="checkbox" value="0" data-label="Chile pica"> <span>Chile pica</span></label>
          <label class="opt"><input type="checkbox" value="0" data-label="Chile no pica"> <span>Chile no pica</span></label>
          <label class="opt"><input type="checkbox" value="0" data-label="Queso rallado"> <span>Queso rallado</span></label>
          <label class="opt"><input type="checkbox" value="0" data-label="Lim√≥n"> <span>Lim√≥n</span></label>

          <label class="opt"><input type="checkbox" value="0" data-label="Cacahuate japon√©s"> <span>Cacahuate japon√©s</span></label>
          <label class="opt"><input type="checkbox" value="0" data-label="Cacahuate salado"> <span>Cacahuate salado</span></label>
          <label class="opt"><input type="checkbox" value="0" data-label="Churrito rojo"> <span>Churrito rojo</span></label>
          <label class="opt"><input type="checkbox" value="0" data-label="Salsa Don Vasco"> <span>Salsa Don Vasco</span></label>

          <label class="opt"><input type="checkbox" value="0" data-label="Salsa negra"> <span>Salsa negra</span></label>
          <label class="opt"><input type="checkbox" value="0" data-label="Salsa pico de gallo"> <span>Salsa pico de gallo</span></label>

          <label class="opt"><input type="checkbox" value="40" data-label="Aguachile de camar√≥n (+$40) (solo viernes)">
            <span>Aguachile de camar√≥n <small>(+$40) (solo viernes)</small></span>
          </label>
        </div>

        <label>Cantidad</label>
        <input type="number" data-field="qty" value="1" min="1">

        <label>Observaciones</label>
        <textarea data-field="notes" placeholder="Ej: bien picoso..."></textarea>

        <button class="btn btn-add" type="button" onclick="addToCartFrom('Dorilocos','prod-dori',50)">‚ûï Agregar</button>
      </div>
    </div>

    <!-- 4) TOSTITOS -->
    <div class="card" id="prod-tostitos">
      <div class="media">
        <img src="tostitos.jpg" alt="Tostitos">
        <div class="titlebar">
          <div class="ptitle">üü© Tostitos</div>
          <div class="badge">$50</div>
        </div>
      </div>
      <div class="content">
        <div class="extras two" data-field="extras">
          <label class="opt"><input type="checkbox" value="0" data-label="Chile pica"> <span>Chile pica</span></label>
          <label class="opt"><input type="checkbox" value="0" data-label="Chile no pica"> <span>Chile no pica</span></label>
          <label class="opt"><input type="checkbox" value="0" data-label="Queso rallado"> <span>Queso rallado</span></label>
          <label class="opt"><input type="checkbox" value="0" data-label="Lim√≥n"> <span>Lim√≥n</span></label>

          <label class="opt"><input type="checkbox" value="0" data-label="Cacahuate japon√©s"> <span>Cacahuate japon√©s</span></label>
          <label class="opt"><input type="checkbox" value="0" data-label="Cacahuate salado"> <span>Cacahuate salado</span></label>
          <label class="opt"><input type="checkbox" value="0" data-label="Churrito rojo"> <span>Churrito rojo</span></label>
          <label class="opt"><input type="checkbox" value="0" data-label="Salsa Don Vasco"> <span>Salsa Don Vasco</span></label>
          <label class="opt"><input type="checkbox" value="0" data-label="Salsa negra"> <span>Salsa negra</span></label>

          <label class="opt"><input type="checkbox" value="40" data-label="Aguachile de camar√≥n (+$40) (solo viernes)">
            <span>Aguachile de camar√≥n <small>(+$40) (solo viernes)</small></span>
          </label>
        </div>

        <label>Cantidad</label>
        <input type="number" data-field="qty" value="1" min="1">

        <label>Observaciones</label>
        <textarea data-field="notes" placeholder="Ej: con mucho aguachile..."></textarea>

        <button class="btn btn-add" type="button" onclick="addToCartFrom('Tostitos','prod-tostitos',50)">‚ûï Agregar</button>
      </div>
    </div>

    <!-- 5) PAPAS LOCAS -->
    <div class="card" id="prod-papas">
      <div class="media">
        <img src="papas.jpg" alt="Papas locas">
        <div class="titlebar">
          <div class="ptitle">ü•î Papas locas</div>
          <div class="badge">$50</div>
        </div>
      </div>
      <div class="content">
        <div class="extras two" data-field="extras">
          <label class="opt"><input type="checkbox" value="0" data-label="Chile pica"> <span>Chile pica</span></label>
          <label class="opt"><input type="checkbox" value="0" data-label="Chile no pica"> <span>Chile no pica</span></label>
          <label class="opt"><input type="checkbox" value="0" data-label="Queso rallado"> <span>Queso rallado</span></label>
          <label class="opt"><input type="checkbox" value="0" data-label="Lim√≥n"> <span>Lim√≥n</span></label>

          <label class="opt"><input type="checkbox" value="0" data-label="Cueritos"> <span>Cueritos</span></label>
          <label class="opt"><input type="checkbox" value="0" data-label="Pepino"> <span>Pepino</span></label>
          <label class="opt"><input type="checkbox" value="0" data-label="J√≠cama"> <span>J√≠cama</span></label>
          <label class="opt"><input type="checkbox" value="0" data-label="Cacahuate japon√©s"> <span>Cacahuate japon√©s</span></label>

          <label class="opt"><input type="checkbox" value="0" data-label="Cacahuate salado"> <span>Cacahuate salado</span></label>
          <label class="opt"><input type="checkbox" value="0" data-label="Salsa Don Vasco"> <span>Salsa Don Vasco</span></label>
          <label class="opt"><input type="checkbox" value="0" data-label="Salsa negra"> <span>Salsa negra</span></label>

          <label class="opt"><input type="checkbox" value="40" data-label="Aguachile de camar√≥n (+$40) (solo viernes)">
            <span>Aguachile de camar√≥n <small>(+$40) (solo viernes)</small></span>
          </label>
        </div>

        <label>Cantidad</label>
        <input type="number" data-field="qty" value="1" min="1">

        <label>Observaciones</label>
        <textarea data-field="notes" placeholder="Ej: sin cueritos..."></textarea>

        <button class="btn btn-add" type="button" onclick="addToCartFrom('Papas locas','prod-papas',50)">‚ûï Agregar</button>
      </div>
    </div>

  </div>
</div>

<!-- TOAST -->
<div id="toast" class="toast">
  <span id="toastText">‚úÖ Agregado</span>
  <button type="button" onclick="openCart()">Ver carrito</button>
</div>

<!-- MODAL CARRITO -->
<div id="overlay" class="overlay" onclick="closeCart()"></div>
<div id="panel" class="panel" aria-hidden="true">
  <div class="panel-head">
    <h3>üß∫ Tu pedido</h3>
    <button class="xbtn" type="button" onclick="closeCart()">‚úï</button>
  </div>
  <div class="panel-body">
    <div id="cartList"></div>

    <div class="totals">
      <div class="trow"><span>Subtotal</span><span id="subVal">$0</span></div>
      <div class="trow"><span>Total</span><span id="totVal">$0</span></div>
    </div>

    <button class="wa" type="button" onclick="sendWhats()">üì≤ Realizar pedido por WhatsApp</button>
    <button class="danger" type="button" onclick="clearCart()">üóëÔ∏è Vaciar carrito</button>
  </div>
</div>

<!-- FAB -->
<div id="fab" class="fab hide" onclick="openCart()">
  <div class="left">
    <div class="dot" id="fabCount">0</div>
    <div class="meta">
      <strong>Ver carrito</strong>
      <span>Subtotal en vivo</span>
    </div>
  </div>
  <div style="display:flex;align-items:center;gap:10px">
    <div class="money" id="fabMoney">$0</div>
    <button class="cta" type="button" onclick="openCart()">Abrir</button>
  </div>
</div>

<script>
/* ===== CONFIG ===== */
const WA_NUMBER = "5214774961901";
let cart = [];
let toastTimer = null;

/* ===== FX: sonido + vibraci√≥n ===== */
let audioCtx = null;
function playAddSound(){
  try{
    if(!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    const ctx = audioCtx;
    const o = ctx.createOscillator();
    const g = ctx.createGain();
    o.type = "triangle";
    o.frequency.setValueAtTime(740, ctx.currentTime);
    o.frequency.exponentialRampToValueAtTime(520, ctx.currentTime + 0.08);
    g.gain.setValueAtTime(0.0001, ctx.currentTime);
    g.gain.exponentialRampToValueAtTime(0.18, ctx.currentTime + 0.01);
    g.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime + 0.11);
    o.connect(g); g.connect(ctx.destination);
    o.start(); o.stop(ctx.currentTime + 0.12);
  }catch(e){}
}
function vibrate(){
  if(navigator.vibrate) navigator.vibrate([22,18,22]);
}
function showToast(text){
  const t = document.getElementById("toast");
  document.getElementById("toastText").textContent = text;
  t.classList.add("show");
  clearTimeout(toastTimer);
  toastTimer = setTimeout(()=> t.classList.remove("show"), 1700);
}

/* ===== Carrito panel ===== */
function openCart(){
  document.getElementById("overlay").classList.add("open");
  document.getElementById("panel").classList.add("open");
  document.getElementById("panel").setAttribute("aria-hidden","false");
}
function closeCart(){
  document.getElementById("overlay").classList.remove("open");
  document.getElementById("panel").classList.remove("open");
  document.getElementById("panel").setAttribute("aria-hidden","true");
}
document.addEventListener("keydown",(e)=>{ if(e.key==="Escape") closeCart(); });

/* ===== Utils ===== */
function money(n){ return "$" + Math.round(n); }
function getCheckedExtras(root){
  const wrap = root.querySelector('[data-field="extras"]');
  if(!wrap) return {sum:0, labels:[]};
  const checks = [...wrap.querySelectorAll('input[type="checkbox"]')];
  let sum = 0;
  let labels = [];
  checks.forEach(ch=>{
    if(ch.checked){
      sum += parseInt(ch.value || "0", 10);
      labels.push(ch.getAttribute("data-label") || "Extra");
    }
  });
  return {sum, labels};
}
function totals(){
  const subtotal = cart.reduce((s, it) => s + it.itemSubtotal, 0);
  return {subtotal, total: subtotal};
}

/* ===== Add to cart ===== */
function addToCartFrom(productName, rootId, baseFixed=0){
  const root = document.getElementById(rootId);

  const qty = Math.max(1, parseInt(root.querySelector('[data-field="qty"]').value || "1", 10) || 1);
  const notes = (root.querySelector('[data-field="notes"]').value || "").trim();

  let unitPrice = 0;
  let infoLines = [];

  // extras (checkbox)
  const ex = getCheckedExtras(root);
  if(ex.labels.length) infoLines.push("Extras: " + ex.labels.join(", "));

  if(productName === "Fruta preparada"){
    const sizeSel = root.querySelector('[data-field="size"]');
    const mangoSel = root.querySelector('[data-field="mango"]');
    unitPrice += parseInt(sizeSel.value, 10);
    unitPrice += parseInt(mangoSel.value, 10); // mango +10
    unitPrice += ex.sum;

    infoLines.unshift("Tama√±o: " + sizeSel.selectedOptions[0].textContent);
    if(parseInt(mangoSel.value,10) > 0) infoLines.push(mangoSel.selectedOptions[0].textContent);
  }
  else if(productName === "Caldo de oso"){
    const sizeSel = root.querySelector('[data-field="size"]');
    const mangoSel = root.querySelector('[data-field="mango"]');
    unitPrice += parseInt(sizeSel.value, 10);
    unitPrice += parseInt(mangoSel.value, 10); // mango +10
    unitPrice += ex.sum;

    infoLines.unshift("Tama√±o: " + sizeSel.selectedOptions[0].textContent);
    if(parseInt(mangoSel.value,10) > 0) infoLines.push(mangoSel.selectedOptions[0].textContent);
  }
  else{
    unitPrice += baseFixed; // 50
    unitPrice += ex.sum;
  }

  const itemSubtotal = unitPrice * qty;
  if(notes) infoLines.push("Obs: " + notes);

  cart.push({
    id: (crypto.randomUUID ? crypto.randomUUID() : String(Date.now()) + Math.random()),
    productName,
    qty,
    itemSubtotal,
    info: infoLines.join("\n")
  });

  // FX
  playAddSound();
  vibrate();
  showToast(`‚úÖ Agregado: x${qty} ${productName}`);

  // no abrir carrito
  renderCart();
}

/* ===== Render ===== */
function renderCart(){
  const list = document.getElementById("cartList");
  const fab = document.getElementById("fab");
  const {subtotal, total} = totals();

  document.getElementById("subVal").textContent = money(subtotal);
  document.getElementById("totVal").textContent = money(total);

  document.getElementById("fabCount").textContent = String(cart.length);
  document.getElementById("fabMoney").textContent = money(total);

  if(cart.length === 0){
    fab.classList.add("hide");
    list.innerHTML = `<div style="padding:12px;border:1px solid rgba(229,231,235,.95);border-radius:14px;background:#fff;color:#64748b;font-weight:800">
      Tu carrito est√° vac√≠o. Agrega algo del men√∫ üëá
    </div>`;
    return;
  }
  fab.classList.remove("hide");

  list.innerHTML = cart.map((it,i)=>`
    <div class="item">
      <div class="row">
        <div><b>${i+1}) x${it.qty} ${it.productName}</b></div>
        <button class="mini" type="button" onclick="removeItem('${it.id}')">Quitar</button>
      </div>
      <div class="small">${it.info}\nSubtotal: ${money(it.itemSubtotal)}</div>
    </div>
  `).join("");
}

function removeItem(id){
  cart = cart.filter(x=>x.id!==id);
  renderCart();
}
function clearCart(){
  cart = [];
  renderCart();
  closeCart();
}

/* ===== WhatsApp (subtotales + total) ===== */
function sendWhats(){
  if(cart.length === 0){
    alert("Tu carrito est√° vac√≠o. Agrega al menos un producto.");
    return;
  }

  const {subtotal, total} = totals();
  let msg = "Hola, quiero pedir en FRUT√çSIMA MADRE:\n\nüß∫ Pedido:\n";

  cart.forEach((it, idx)=>{
    msg += `${idx+1}) x${it.qty} ${it.productName}\n`;
    if(it.info) msg += it.info.split("\n").map(l=>"   - "+l).join("\n") + "\n";
    msg += `   Subtotal: ${money(it.itemSubtotal)}\n\n`;
  });

  msg += `üí∞ Subtotal general: ${money(subtotal)}\n`;
  msg += `üí∞ Total: ${money(total)}\n`;

  window.location.href = `https://wa.me/${WA_NUMBER}?text=${encodeURIComponent(msg)}`;
}

/* init */
renderCart();
</script>

</body>
</html>
